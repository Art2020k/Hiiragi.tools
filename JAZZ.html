<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <title>SENSES Vinyl Jazz Player</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Fonts: Playfair Display & Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;1,400&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">

    <style>
        :root {
            --record-speed: 1.8s;
            --bg-color: #e5e5e5;
            --player-bg: #f4f4f5;
            --accent-color: #27272a;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--accent-color);
            overflow: hidden;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .ambient-bg {
            position: absolute;
            inset: 0;
            background: 
                radial-gradient(circle at 0% 0%, #ffffff 0%, transparent 60%),
                radial-gradient(circle at 100% 100%, #d4d4d8 0%, transparent 60%);
            z-index: -1;
        }

        .texture-overlay {
            position: absolute;
            inset: 0;
            opacity: 0.3;
            pointer-events: none;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.15'/%3E%3C/svg%3E");
            z-index: 0;
        }

        .vinyl-grooves {
            background: 
                repeating-radial-gradient(
                #18181b, 
                #18181b 2px, 
                #09090b 3px, 
                #09090b 4px
                );
            box-shadow: 
                inset 0 0 0 2px #27272a,
                0 20px 40px -10px rgba(0,0,0,0.3);
        }

        .vinyl-gloss {
            background: conic-gradient(
                transparent 0deg,
                rgba(255, 255, 255, 0.08) 40deg,
                transparent 70deg,
                transparent 180deg,
                rgba(255, 255, 255, 0.08) 220deg,
                transparent 250deg,
                transparent 360deg
            );
            border-radius: 50%;
        }

        @keyframes spin { 100% { transform: rotate(360deg); } }
        .spinning { animation: spin var(--record-speed) linear infinite; }
        .paused-spin { animation-play-state: paused; }

        .arm-container {
            transform-origin: 50% 15%; 
            transition: transform 1.5s cubic-bezier(0.4, 0, 0.2, 1);
            transform: rotate(-35deg);
        }
        
        .arm-container.playing { transform: rotate(22deg); }

        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }
        
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 12px;
            width: 12px;
            border-radius: 50%;
            background: #27272a;
            cursor: pointer;
            margin-top: -5px;
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 2px;
            cursor: pointer;
            background: #d4d4d8;
        }

        .font-display { font-family: 'Playfair Display', serif; }

        .player-box {
            background-color: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 20px 50px -10px rgba(0, 0, 0, 0.08);
        }

        #player {
            position: absolute;
            top: -9999px;
            left: -9999px;
            visibility: hidden;
        }

        /* Error Banner */
        #error-banner {
            display: none;
            position: absolute;
            top: 20px;
            background: #27272a;
            color: white;
            padding: 8px 20px;
            border-radius: 30px;
            font-size: 10px;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            z-index: 100;
        }
    </style>
</head>
<body class="h-screen w-screen flex flex-col items-center justify-center relative">

    <div class="ambient-bg"></div>
    <div class="texture-overlay"></div>

    <div id="error-banner">Security restriction detected. Trying fallback...</div>

    <!-- Main Player Unit -->
    <div class="z-10 relative player-box rounded-[2.5rem] p-8 md:p-12 w-full max-w-md md:max-w-3xl flex flex-col md:flex-row items-center gap-10">
        
        <!-- Turntable -->
        <div class="relative w-72 h-72 md:w-80 md:h-80 flex-shrink-0 group">
            <div class="absolute inset-0 rounded-full bg-zinc-200/50 shadow-inner border border-zinc-300/30"></div>
            <div id="record" class="absolute inset-2 rounded-full vinyl-grooves flex items-center justify-center transition-transform duration-1000">
                <div class="absolute inset-0 vinyl-gloss z-10"></div>
                <div class="relative z-20 w-32 h-32 rounded-full overflow-hidden border border-zinc-900 bg-zinc-900 flex items-center justify-center">
                    <img id="album-art" src="" alt="" class="w-full h-full object-cover opacity-70 grayscale transition-all duration-700">
                    <div id="label-status" class="absolute inset-0 flex items-center justify-center bg-black/60 text-white text-[10px] font-medium tracking-widest uppercase hidden text-center p-2">
                        Loading...
                    </div>
                    <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-1.5 h-1.5 bg-zinc-100 rounded-full"></div>
                </div>
            </div>

            <div id="tone-arm" class="arm-container absolute -top-8 -right-6 w-24 h-64 pointer-events-none z-30">
                <div class="absolute top-8 left-1/2 transform -translate-x-1/2 w-14 h-14 rounded-full bg-zinc-100 shadow-sm border border-zinc-200/50 flex items-center justify-center">
                    <div class="w-3 h-3 rounded-full bg-zinc-300"></div>
                </div>
                <div class="absolute top-16 left-1/2 transform -translate-x-1/2 w-1.5 h-40 bg-zinc-900 rounded-full shadow-sm"></div>
                <div class="absolute bottom-6 left-1/2 transform -translate-x-1/2 w-5 h-12 bg-zinc-900 rounded-sm"></div>
            </div>
        </div>

        <!-- Controls -->
        <div class="flex flex-col w-full space-y-8">
            <div class="text-center md:text-left space-y-2">
                <div class="flex items-center justify-center md:justify-start gap-2">
                    <span class="w-8 h-[1px] bg-zinc-300"></span>
                    <h2 class="text-[9px] font-semibold tracking-[0.3em] text-zinc-400 uppercase">SENSES ARCHIVE</h2>
                </div>
                <h1 id="track-title" class="text-2xl md:text-3xl font-display italic text-zinc-900 leading-tight">Chill Jazz</h1>
                <p class="text-[10px] text-zinc-400 font-light tracking-[0.2em] uppercase">Architecture of Sound</p>
            </div>

            <div class="flex items-center justify-center md:justify-start gap-10">
                <button id="prev-btn" class="text-zinc-300 hover:text-zinc-900 transition-colors">
                    <i data-lucide="chevron-left" class="w-5 h-5"></i>
                </button>
                <button id="play-btn" class="w-16 h-16 rounded-full bg-zinc-900 text-white flex items-center justify-center shadow-xl hover:scale-105 transition-all active:scale-95 group">
                    <i id="play-icon" data-lucide="play" class="w-6 h-6 fill-white ml-1"></i>
                </button>
                <button id="next-btn" class="text-zinc-300 hover:text-zinc-900 transition-colors">
                    <i data-lucide="chevron-right" class="w-5 h-5"></i>
                </button>
            </div>

            <div class="space-y-6 pt-4">
                <div class="flex items-center gap-4">
                    <i data-lucide="volume-2" class="w-3 h-3 text-zinc-300"></i>
                    <input type="range" id="volume-slider" min="0" max="100" value="80" class="flex-1">
                </div>
                <div class="flex items-center gap-4">
                    <i data-lucide="layers" class="w-3 h-3 text-zinc-300"></i>
                    <div class="flex-1 flex flex-col">
                        <div class="flex justify-between text-[8px] tracking-[0.2em] text-zinc-400 mb-2 uppercase">
                            <span>Analog Texture</span>
                            <span id="noise-label">25%</span>
                        </div>
                        <input type="range" id="noise-slider" min="0" max="100" value="25" class="flex-1">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Hidden Player -->
    <div id="player-container">
        <div id="player"></div>
    </div>

    <script>
        lucide.createIcons();

        // Target Playlists
        const TARGET_IDS = ['neV3EPgvZ3g', 'kLlzfiVHVnc', 'eB0arUZ-63I', 'x57GYTMVxqI'];
        const SAFE_IDS = ['jfKfPfyJRdk', '5yx6BWlEVcY', 'Hu4YEQT7n-k'];
        let PLAYLIST = [...TARGET_IDS, ...SAFE_IDS];
        
        let currentTrackIndex = 0;
        let player;
        let isPlaying = false;
        let consecutiveErrors = 0;

        // API Loader
        const tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        document.head.appendChild(tag);

        function onYouTubeIframeAPIReady() {
            createPlayer(PLAYLIST[currentTrackIndex]);
        }

        function createPlayer(videoId) {
            // If player exists, destroy it
            if (player) {
                try { player.destroy(); } catch(e) {}
                const container = document.getElementById('player-container');
                container.innerHTML = '<div id="player"></div>';
            }

            const origin = window.location.origin === 'null' ? '*' : window.location.origin;

            player = new YT.Player('player', {
                height: '0',
                width: '0',
                videoId: videoId,
                playerVars: {
                    'enablejsapi': 1,
                    'origin': origin,
                    'autoplay': 0,
                    'controls': 0,
                    'showinfo': 0,
                    'modestbranding': 1,
                    'rel': 0,
                    'playsinline': 1
                },
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange,
                    'onError': onPlayerError
                }
            });
        }

        function onPlayerReady(event) {
            const iframe = document.getElementById('player');
            if (iframe) {
                // Technical Force: Overwrite iframe attributes for security bypass
                iframe.setAttribute('referrerpolicy', 'no-referrer-when-downgrade');
                iframe.setAttribute('allow', 'autoplay; encrypted-media; picture-in-picture');
            }
            updateTrackInfo();
            initAudioContext();
            setLabelStatus(null);
            document.getElementById('error-banner').style.display = 'none';
        }

        function onPlayerError(event) {
            console.warn("Error Detected:", event.data);
            consecutiveErrors++;
            
            document.getElementById('error-banner').style.display = 'block';
            setLabelStatus("Bypassing...");

            if (consecutiveErrors >= PLAYLIST.length) {
                setPlayingState(false);
                document.getElementById('track-title').textContent = "Security Blocked";
                return;
            }

            // Fallback strategy: Skip to next track
            setTimeout(() => {
                nextTrack();
            }, 1000);
        }

        function onPlayerStateChange(event) {
            if (event.data == YT.PlayerState.PLAYING) {
                consecutiveErrors = 0;
                setPlayingState(true);
                setLabelStatus(null);
            } else if (event.data == YT.PlayerState.PAUSED || event.data == YT.PlayerState.ENDED) {
                setPlayingState(false);
            }
            updateTrackInfo();
        }

        // --- Logic UI ---
        const record = document.getElementById('record');
        const toneArm = document.getElementById('tone-arm');
        const playBtn = document.getElementById('play-btn');
        const albumArt = document.getElementById('album-art');
        const titleEl = document.getElementById('track-title');
        const labelStatus = document.getElementById('label-status');

        function setLabelStatus(text) {
            if (text) { labelStatus.textContent = text; labelStatus.classList.remove('hidden'); }
            else { labelStatus.classList.add('hidden'); }
        }

        function setPlayingState(playing) {
            isPlaying = playing;
            if (isPlaying) {
                record.classList.add('spinning');
                record.classList.remove('paused-spin');
                toneArm.classList.add('playing');
                playBtn.innerHTML = '<i data-lucide="pause" class="w-6 h-6 fill-white"></i>';
                lucide.createIcons();
                startNoise();
            } else {
                record.classList.add('paused-spin');
                toneArm.classList.remove('playing');
                playBtn.innerHTML = '<i data-lucide="play" class="w-6 h-6 fill-white ml-1"></i>';
                lucide.createIcons();
                stopNoise();
            }
        }

        function updateTrackInfo() {
            if (player && player.getVideoData) {
                const data = player.getVideoData();
                if (data.title) {
                    titleEl.textContent = data.title.split(' - ')[0] || "Chill Jazz";
                    albumArt.src = `https://i.ytimg.com/vi/${data.video_id}/hqdefault.jpg`;
                }
            }
        }

        // --- Audio Context ---
        let audioCtx, masterGain, noiseSource;
        function initAudioContext() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                masterGain = audioCtx.createGain();
                masterGain.connect(audioCtx.destination);
                setNoiseVolume(document.getElementById('noise-slider').value);
            }
        }

        function startNoise() {
            if (!audioCtx) initAudioContext();
            if (audioCtx.state === 'suspended') audioCtx.resume();
            if (noiseSource) return;
            const buffer = audioCtx.createBuffer(1, audioCtx.sampleRate * 5, audioCtx.sampleRate);
            const data = buffer.getChannelData(0);
            for (let i = 0; i < data.length; i++) {
                data[i] = (Math.random() * 2 - 1) * 0.03;
                if (Math.random() < 0.0001) data[i] += (Math.random() * 2 - 1) * 0.5;
            }
            noiseSource = audioCtx.createBufferSource();
            noiseSource.buffer = buffer;
            noiseSource.loop = true;
            const filter = audioCtx.createBiquadFilter();
            filter.type = 'lowpass'; filter.frequency.value = 500;
            noiseSource.connect(filter); filter.connect(masterGain);
            noiseSource.start();
        }

        function stopNoise() { if (noiseSource) { noiseSource.stop(); noiseSource.disconnect(); noiseSource = null; } }
        function setNoiseVolume(val) { if (masterGain) masterGain.gain.setTargetAtTime((val/100)*0.1, audioCtx.currentTime, 0.1); }

        // --- Event Handlers ---
        playBtn.addEventListener('click', () => {
            if (!player) return;
            if (audioCtx && audioCtx.state === 'suspended') audioCtx.resume();
            if (isPlaying) player.pauseVideo(); else player.playVideo();
        });
        document.getElementById('next-btn').addEventListener('click', nextTrack);
        document.getElementById('prev-btn').addEventListener('click', () => {
            currentTrackIndex = (currentTrackIndex - 1 + PLAYLIST.length) % PLAYLIST.length;
            createPlayer(PLAYLIST[currentTrackIndex]);
        });
        function nextTrack() {
            currentTrackIndex = (currentTrackIndex + 1) % PLAYLIST.length;
            createPlayer(PLAYLIST[currentTrackIndex]);
        }
        document.getElementById('volume-slider').addEventListener('input', (e) => player.setVolume(e.target.value));
        document.getElementById('noise-slider').addEventListener('input', (e) => {
            document.getElementById('noise-label').textContent = e.target.value + '%';
            setNoiseVolume(e.target.value);
        });

    </script>
</body>
</html>